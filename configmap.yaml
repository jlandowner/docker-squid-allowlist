apiVersion: v1
kind: ConfigMap
metadata:
  name: squid-conf
data:
  squid.conf: |
    #Recommended minimum configuration:
    acl all src all
    acl manager proto cache_object
    #acl localhost src 127.0.0.1/32
    #acl to_localhost dst 10.110.0.0/16
    # Example rule allowing access from your local networks
    # Adapt to list your (internal) IP networks from where browsing
    # should be allowed
    acl localnet src 10.110.0.0/16 # Harbor VPC
    # Example rule allowing access from your local networks.
    # Adapt localnet in the ACL section to list your (internal) IP networks
    # from where browsing should be allowed
    http_access allow localhost
    # http_access allow localnet
    http_access deny !localnet

    acl whitelist dstdomain "/etc/squid/whitelist"
    http_access allow whitelist
    # And finally deny all other access to this proxy
    http_access deny all
    #Allow ICP queries from local networks only
    icp_access allow localnet
    icp_access deny all
    # Squid normally listens to port 3128
    http_port 3128
    # parent-proxy
    #cache_peer localhost parent 10080 3130
    #acl SSL method CONNECT
    #never_direct allow SSL
